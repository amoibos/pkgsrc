$NetBSD: patch-CVE-2012-4538,v 1.1 2012/11/14 13:42:41 drochner Exp $

see http://lists.xen.org/archives/html/xen-devel/2012-11/msg00504.html

--- xen/arch/x86/mm/shadow/multi.c.orig	2012-08-10 13:51:46.000000000 +0000
+++ xen/arch/x86/mm/shadow/multi.c
@@ -4737,8 +4737,12 @@ static void sh_pagetable_dying(struct vc
     }
     for ( i = 0; i < 4; i++ )
     {
-        if ( fast_path )
-            smfn = _mfn(pagetable_get_pfn(v->arch.shadow_table[i]));
+        if ( fast_path ) {
+	    if ( pagetable_is_null(v->arch.shadow_table[i]) )
+		smfn = _mfn(INVALID_MFN);
+	    else
+                smfn = _mfn(pagetable_get_pfn(v->arch.shadow_table[i]));
+	}
         else
         {
             /* retrieving the l2s */
