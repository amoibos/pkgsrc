$NetBSD: patch-aa,v 1.14 2014/08/17 09:42:27 wiz Exp $

--- Makefile.orig	2009-04-29 05:18:57.000000000 +0000
+++ Makefile
@@ -81,7 +84,7 @@ windows_ARCH_LINKS:=-lintl $(PNG) -lwins
 osx_ARCH_LINKS:=$(PAPER_LIB) $(FRIBIDI_LIB)
 beos_ARCH_LINKS:="-lintl $(PNG) -lz -lbe -liconv $(FRIBIDI_LIB)"
 linux_ARCH_LINKS:=$(PAPER_LIB) $(FRIBIDI_LIB)
-ARCH_LINKS:=$($(OS)_ARCH_LINKS)
+ARCH_LINKS:=$($(OS)_ARCH_LINKS) $(LIBS)
 
 windows_ARCH_HEADERS:=src/win32_print.h
 osx_ARCH_HEADERS:=
@@ -301,9 +304,12 @@ nokia770:
 POFILES:=$(wildcard src/po/*.po)
 MOFILES:=$(patsubst src/po/%.po,trans/%.mo,$(POFILES))
 INSTALLED_MOFILES:=$(patsubst trans/%.mo,$(LOCALE_PREFIX)/%/LC_MESSAGES/tuxpaint.mo,$(MOFILES))
+INSTALLED_MODIRS:=$(patsubst trans/%.mo,$(LOCALE_PREFIX)/%/LC_MESSAGES,$(MOFILES))
 
+$(INSTALLED_MODIRS): $(LOCALE_PREFIX)/%/LC_MESSAGES: trans/%.mo
+	install -d -m 755 $@
 $(INSTALLED_MOFILES): $(LOCALE_PREFIX)/%/LC_MESSAGES/tuxpaint.mo: trans/%.mo
-	install -D -m 644 $< $@
+	install -m 644 $< $@
 
 .PHONY: uninstall-i18n
 uninstall-i18n:
@@ -331,7 +337,8 @@ install-gettext:
 	@echo "You will not be able to run Tux Paint in non-U.S. English modes."
 	@echo "--------------------------------------------------------------"
 else
-install-gettext: $(INSTALLED_MOFILES)
+install-gettextdirs: $(INSTALLED_MODIRS)
+install-gettext: install-gettextdirs $(INSTALLED_MOFILES)
 endif
 
 
@@ -556,9 +563,8 @@ uninstall:	uninstall-i18n
 install-default-config:
 	@echo
 	@echo "...Installing default config file..."
-	@install -d $(CONFDIR)
-	@cp src/tuxpaint.conf $(CONFDIR)
-	@chmod 644 $(CONFDIR)/tuxpaint.conf
+	@$(BSD_INSTALL_DATA_DIR) ${DESTDIR}$(PREFIX)/share/examples/tuxpaint
+	@$(BSD_INSTALL_DATA) src/tuxpaint.conf ${DESTDIR}$(PREFIX)/share/examples/tuxpaint
 
 
 # Install example stamps
@@ -575,11 +581,13 @@ STARTERS:=$(wildcard starters/*.*)
 INSTALLED_STARTERS:=$(patsubst %,$(DATA_PREFIX)/%,$(STARTERS))
 
 $(INSTALLED_STARTERS): $(DATA_PREFIX)/%: %
-	install -D -m 644 $< $@
+	install -m 644 $< $@
 
 # Install example starters
 .PHONY: install-example-starters
-install-example-starters: $(INSTALLED_STARTERS)
+install-example-starters-dirs:
+	install -d -m 755 $(DATA_PREFIX)/starters
+install-example-starters: install-example-starters-dirs $(INSTALLED_STARTERS)
 
 
 # Install a launcher icon in the Gnome menu
@@ -832,7 +840,7 @@ tuxpaint:	obj/tuxpaint.o obj/i18n.o obj/
 		$(ARCH_LIBS)
 	@echo
 	@echo "...Linking Tux Paint..."
-	$(CC) $(CFLAGS) $(DEBUG_FLAGS) $(SDL_CFLAGS) $(FRIBIDI_CFLAGS) $(DEFS) \
+	$(CC) $(CFLAGS) $(DEBUG_FLAGS) $(LDFLAGS) $(SDL_CFLAGS) $(FRIBIDI_CFLAGS) $(DEFS) \
 		-o tuxpaint $^ \
 		$(SDL_LIBS) $(SVG_LIB) $(ARCH_LINKS)
 	@$(RSRC_CMD)
