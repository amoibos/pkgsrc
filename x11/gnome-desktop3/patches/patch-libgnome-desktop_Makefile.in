$NetBSD: patch-libgnome-desktop_Makefile.in,v 1.1 2014/09/21 04:43:51 prlw1 Exp $

Fix build on systems which don't provide openat()
https://bugzilla.gnome.org/show_bug.cgi?id=735974

--- libgnome-desktop/Makefile.in.orig	2014-09-21 04:29:16.000000000 +0000
+++ libgnome-desktop/Makefile.in
@@ -1,4 +1,4 @@
-# Makefile.in generated by automake 1.13.4 from Makefile.am.
+# Makefile.in generated by automake 1.14.1 from Makefile.am.
 # @configure_input@
 
 # Copyright (C) 1994-2013 Free Software Foundation, Inc.
@@ -98,14 +98,18 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+@USE_LIBGSYSTEM_TRUE@am__append_1 = -I$(srcdir)/libgsystem
 DIST_COMMON = $(srcdir)/libgsystem/Makefile-libgsystem.am \
 	$(srcdir)/Makefile.in $(srcdir)/Makefile.am \
 	$(srcdir)/gnome-desktop-3.0.pc.in \
 	$(srcdir)/gnome-desktop-3.0-uninstalled.pc.in \
 	$(top_srcdir)/depcomp $(libgnome_desktop_HEADERS)
-@HAVE_INTROSPECTION_TRUE@am__append_1 = $(patsubst %,--c-include='libgnome-desktop/%',$(libgnome_desktop_HEADERS))
-@HAVE_INTROSPECTION_TRUE@am__append_2 = GnomeDesktop-3.0.gir
-@HAVE_INTROSPECTION_TRUE@am__append_3 = $(gir_DATA) $(typelib_DATA)
+@USE_LIBGSYSTEM_TRUE@am__append_2 = $(libgsystem_srcpath)/README $(libgsystem_srcpath)/COPYING
+@USE_LIBGSYSTEM_TRUE@am__append_3 = libgsystem.la
+@USE_LIBGSYSTEM_TRUE@am__append_4 = libgsystem.la
+@HAVE_INTROSPECTION_TRUE@am__append_5 = $(patsubst %,--c-include='libgnome-desktop/%',$(libgnome_desktop_HEADERS))
+@HAVE_INTROSPECTION_TRUE@am__append_6 = GnomeDesktop-3.0.gir
+@HAVE_INTROSPECTION_TRUE@am__append_7 = $(gir_DATA) $(typelib_DATA)
 libexec_PROGRAMS = gnome-rr-debug$(EXEEXT)
 noinst_PROGRAMS = test-xkb-info$(EXEEXT) test-pnp-ids$(EXEEXT) \
 	test-wall-clock$(EXEEXT) test-desktop-thumbnail$(EXEEXT) \
@@ -158,7 +162,7 @@ am__installdirs = "$(DESTDIR)$(libdir)" 
 LTLIBRARIES = $(lib_LTLIBRARIES) $(noinst_LTLIBRARIES)
 am__DEPENDENCIES_1 =
 libgnome_desktop_3_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \
-	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) libgsystem.la
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) $(am__append_4)
 am__objects_1 = gnome-desktop-thumbnail.lo \
 	gnome-thumbnail-pixbuf-utils.lo gnome-bg.lo \
 	gnome-bg-slide-show.lo gnome-bg-crossfade.lo gnome-rr.lo \
@@ -178,18 +182,40 @@ libgnome_desktop_3_la_LINK = $(LIBTOOL) 
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(AM_CFLAGS) $(CFLAGS) $(libgnome_desktop_3_la_LDFLAGS) \
 	$(LDFLAGS) -o $@
-am__DEPENDENCIES_2 = $(am__DEPENDENCIES_1)
-libgsystem_la_DEPENDENCIES = $(am__DEPENDENCIES_2)
-am_libgsystem_la_OBJECTS = libgsystem_la-gsystem-local-alloc.lo \
-	libgsystem_la-gsystem-console.lo \
-	libgsystem_la-gsystem-file-utils.lo \
-	libgsystem_la-gsystem-shutil.lo libgsystem_la-gsystem-log.lo \
-	libgsystem_la-gsystem-subprocess-context.lo \
-	libgsystem_la-gsystem-subprocess.lo
+@USE_LIBGSYSTEM_TRUE@am__DEPENDENCIES_2 = $(am__DEPENDENCIES_1)
+@USE_LIBGSYSTEM_TRUE@libgsystem_la_DEPENDENCIES =  \
+@USE_LIBGSYSTEM_TRUE@	$(am__DEPENDENCIES_2)
+am__libgsystem_la_SOURCES_DIST =  \
+	$(libgsystem_srcpath)/gsystem-local-alloc.h \
+	$(libgsystem_srcpath)/gsystem-local-alloc.c \
+	$(libgsystem_srcpath)/gsystem-console.h \
+	$(libgsystem_srcpath)/gsystem-console.c \
+	$(libgsystem_srcpath)/gsystem-file-utils.h \
+	$(libgsystem_srcpath)/gsystem-file-utils.c \
+	$(libgsystem_srcpath)/gsystem-glib-compat.h \
+	$(libgsystem_srcpath)/gsystem-shutil.h \
+	$(libgsystem_srcpath)/gsystem-shutil.c \
+	$(libgsystem_srcpath)/gsystem-log.h \
+	$(libgsystem_srcpath)/gsystem-log.c \
+	$(libgsystem_srcpath)/gsystem-subprocess-context.h \
+	$(libgsystem_srcpath)/gsystem-subprocess-context-private.h \
+	$(libgsystem_srcpath)/gsystem-subprocess-context.c \
+	$(libgsystem_srcpath)/gsystem-subprocess.h \
+	$(libgsystem_srcpath)/gsystem-subprocess.c \
+	$(libgsystem_srcpath)/libgsystem.h
+@USE_LIBGSYSTEM_TRUE@am_libgsystem_la_OBJECTS =  \
+@USE_LIBGSYSTEM_TRUE@	libgsystem_la-gsystem-local-alloc.lo \
+@USE_LIBGSYSTEM_TRUE@	libgsystem_la-gsystem-console.lo \
+@USE_LIBGSYSTEM_TRUE@	libgsystem_la-gsystem-file-utils.lo \
+@USE_LIBGSYSTEM_TRUE@	libgsystem_la-gsystem-shutil.lo \
+@USE_LIBGSYSTEM_TRUE@	libgsystem_la-gsystem-log.lo \
+@USE_LIBGSYSTEM_TRUE@	libgsystem_la-gsystem-subprocess-context.lo \
+@USE_LIBGSYSTEM_TRUE@	libgsystem_la-gsystem-subprocess.lo
 libgsystem_la_OBJECTS = $(am_libgsystem_la_OBJECTS)
 libgsystem_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(libgsystem_la_CFLAGS) \
 	$(CFLAGS) $(libgsystem_la_LDFLAGS) $(LDFLAGS) -o $@
+@USE_LIBGSYSTEM_TRUE@am_libgsystem_la_rpath =
 PROGRAMS = $(libexec_PROGRAMS) $(noinst_PROGRAMS)
 am_gnome_rr_debug_OBJECTS = gnome-rr-debug.$(OBJEXT)
 gnome_rr_debug_OBJECTS = $(am_gnome_rr_debug_OBJECTS)
@@ -255,7 +281,7 @@ SOURCES = $(libgnome_desktop_3_la_SOURCE
 	test-idle-monitor.c test-languages.c test-pnp-ids.c \
 	test-wall-clock.c test-xkb-info.c
 DIST_SOURCES = $(libgnome_desktop_3_la_SOURCES) \
-	$(libgsystem_la_SOURCES) $(gnome_rr_debug_SOURCES) \
+	$(am__libgsystem_la_SOURCES_DIST) $(gnome_rr_debug_SOURCES) \
 	test-desktop-thumbnail.c test-idle-monitor.c test-languages.c \
 	test-pnp-ids.c test-wall-clock.c test-xkb-info.c
 am__can_run_installinfo = \
@@ -339,7 +365,6 @@ GTKDOC_DEPS_LIBS = @GTKDOC_DEPS_LIBS@
 GTKDOC_MKPDF = @GTKDOC_MKPDF@
 GTKDOC_REBASE = @GTKDOC_REBASE@
 GTK_REQUIRED = @GTK_REQUIRED@
-HELP_DIR = @HELP_DIR@
 HTML_DIR = @HTML_DIR@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
@@ -365,7 +390,6 @@ INTROSPECTION_MAKEFILE = @INTROSPECTION_
 INTROSPECTION_SCANNER = @INTROSPECTION_SCANNER@
 INTROSPECTION_TYPELIBDIR = @INTROSPECTION_TYPELIBDIR@
 ISO_CODES_PREFIX = @ISO_CODES_PREFIX@
-ITSTOOL = @ITSTOOL@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBM = @LIBM@
@@ -421,7 +445,6 @@ XKB_BASE = @XKB_BASE@
 XLIB_CFLAGS = @XLIB_CFLAGS@
 XLIB_LIBS = @XLIB_LIBS@
 XMKMF = @XMKMF@
-XMLLINT = @XMLLINT@
 XRANDR_REQUIRED = @XRANDR_REQUIRED@
 X_CFLAGS = @X_CFLAGS@
 X_EXTRA_LIBS = @X_EXTRA_LIBS@
@@ -481,56 +504,46 @@ target_alias = @target_alias@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
-CLEANFILES = $(am__append_3)
-EXTRA_DIST = \
-	idle-monitor.xml			\
-	xrandr.xml				\
-	gnome-desktop-3.0.pc.in			\
-	gnome-desktop-3.0-uninstalled.pc.in	\
+CLEANFILES = $(am__append_7)
+EXTRA_DIST = $(am__append_2) idle-monitor.xml xrandr.xml \
+	gnome-desktop-3.0.pc.in gnome-desktop-3.0-uninstalled.pc.in \
 	$(pnpdata_DATA_dist)
-
-noinst_LTLIBRARIES = libgsystem.la
+noinst_LTLIBRARIES = $(am__append_3)
 lib_LTLIBRARIES = libgnome-desktop-3.la
-AM_CPPFLAGS = \
-	-I$(top_srcdir)						\
-	-I$(srcdir)/libgsystem					\
-	$(GNOME_DESKTOP_CFLAGS)					\
-	$(XLIB_CFLAGS)						\
-	-DG_LOG_DOMAIN=\"GnomeDesktop\"				\
-	-DGNOMELOCALEDIR=\""$(prefix)/$(DATADIRNAME)/locale\""	\
-	-DISO_CODES_PREFIX=\""$(ISO_CODES_PREFIX)"\"		\
-	-DLIBLOCALEDIR=\""$(prefix)/lib/locale"\"		\
-	-DPNP_IDS=\""$(PNP_IDS)"\"				\
-	-DXKB_BASE=\""$(XKB_BASE)"\"				\
-	$(DISABLE_DEPRECATED_CFLAGS)
-
+AM_CPPFLAGS = -I$(top_srcdir) $(GNOME_DESKTOP_CFLAGS) $(XLIB_CFLAGS) \
+	-DG_LOG_DOMAIN=\"GnomeDesktop\" \
+	-DGNOMELOCALEDIR=\""$(prefix)/$(DATADIRNAME)/locale\"" \
+	-DISO_CODES_PREFIX=\""$(ISO_CODES_PREFIX)"\" \
+	-DLIBLOCALEDIR=\""$(prefix)/lib/locale"\" \
+	-DPNP_IDS=\""$(PNP_IDS)"\" -DXKB_BASE=\""$(XKB_BASE)"\" \
+	$(DISABLE_DEPRECATED_CFLAGS) $(am__append_1)
 AM_CFLAGS = $(WARN_CFLAGS)
-libgsystem_srcpath := libgsystem
-libgsystem_cflags = $(GNOME_DESKTOP_CFLAGS)
-libgsystem_libs = $(GNOME_DESKTOP_LIBS)
-libgsystem_la_SOURCES = \
-	$(libgsystem_srcpath)/gsystem-local-alloc.h \
-	$(libgsystem_srcpath)/gsystem-local-alloc.c \
-	$(libgsystem_srcpath)/gsystem-console.h \
-	$(libgsystem_srcpath)/gsystem-console.c \
-	$(libgsystem_srcpath)/gsystem-file-utils.h \
-	$(libgsystem_srcpath)/gsystem-file-utils.c \
-	$(libgsystem_srcpath)/gsystem-glib-compat.h \
-	$(libgsystem_srcpath)/gsystem-shutil.h \
-	$(libgsystem_srcpath)/gsystem-shutil.c \
-	$(libgsystem_srcpath)/gsystem-log.h \
-	$(libgsystem_srcpath)/gsystem-log.c \
-	$(libgsystem_srcpath)/gsystem-subprocess-context.h \
-	$(libgsystem_srcpath)/gsystem-subprocess-context-private.h \
-	$(libgsystem_srcpath)/gsystem-subprocess-context.c \
-	$(libgsystem_srcpath)/gsystem-subprocess.h \
-	$(libgsystem_srcpath)/gsystem-subprocess.c \
-	$(libgsystem_srcpath)/libgsystem.h \
-	$(NULL)
-
-libgsystem_la_CFLAGS = $(AM_CFLAGS) $(libgsystem_cflags)
-libgsystem_la_LDFLAGS = -avoid-version -Bsymbolic-functions -export-symbols-regex "^gs_" -no-undefined -export-dynamic
-libgsystem_la_LIBADD = $(libgsystem_libs)
+@USE_LIBGSYSTEM_TRUE@libgsystem_srcpath := libgsystem
+@USE_LIBGSYSTEM_TRUE@libgsystem_cflags = $(GNOME_DESKTOP_CFLAGS)
+@USE_LIBGSYSTEM_TRUE@libgsystem_libs = $(GNOME_DESKTOP_LIBS)
+@USE_LIBGSYSTEM_TRUE@libgsystem_la_SOURCES = \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-local-alloc.h \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-local-alloc.c \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-console.h \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-console.c \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-file-utils.h \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-file-utils.c \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-glib-compat.h \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-shutil.h \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-shutil.c \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-log.h \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-log.c \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-subprocess-context.h \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-subprocess-context-private.h \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-subprocess-context.c \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-subprocess.h \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/gsystem-subprocess.c \
+@USE_LIBGSYSTEM_TRUE@	$(libgsystem_srcpath)/libgsystem.h \
+@USE_LIBGSYSTEM_TRUE@	$(NULL)
+
+@USE_LIBGSYSTEM_TRUE@libgsystem_la_CFLAGS = $(AM_CFLAGS) $(libgsystem_cflags)
+@USE_LIBGSYSTEM_TRUE@libgsystem_la_LDFLAGS = -avoid-version -Bsymbolic-functions -export-symbols-regex "^gs_" -no-undefined -export-dynamic
+@USE_LIBGSYSTEM_TRUE@libgsystem_la_LIBADD = $(libgsystem_libs)
 introspection_sources = \
 	gnome-desktop-thumbnail.c 	\
 	gnome-thumbnail-pixbuf-utils.c 	\
@@ -562,13 +575,8 @@ libgnome_desktop_3_la_SOURCES = \
 dbus_xrandr_built_sources = meta-dbus-xrandr.c meta-dbus-xrandr.h
 dbus_idle_built_sources = meta-dbus-idle-monitor.c meta-dbus-idle-monitor.h
 BUILT_SOURCES = $(dbus_xrandr_built_sources) $(dbus_idle_built_sources)
-libgnome_desktop_3_la_LIBADD = \
-	$(XLIB_LIBS)		\
-	$(LIBM)			\
-	$(GNOME_DESKTOP_LIBS)	\
-	libgsystem.la           \
-	-lrt
-
+libgnome_desktop_3_la_LIBADD = $(XLIB_LIBS) $(LIBM) \
+	$(GNOME_DESKTOP_LIBS) -lrt $(am__append_4)
 libgnome_desktop_3_la_LDFLAGS = \
 	-version-info $(LT_VERSION) \
 	-export-symbols-regex "^gnome_.*" \
@@ -593,9 +601,9 @@ libgnome_desktop_HEADERS = \
 @USE_INTERNAL_PNP_IDS_TRUE@pnpdatadir = $(datadir)/libgnome-desktop-3.0
 @USE_INTERNAL_PNP_IDS_TRUE@pnpdata_DATA = pnp.ids
 pnpdata_DATA_dist = pnp.ids
-INTROSPECTION_GIRS = $(am__append_2)
+INTROSPECTION_GIRS = $(am__append_6)
 INTROSPECTION_SCANNER_ARGS = --add-include-path=$(srcdir) --warn-all \
-	$(am__append_1)
+	$(am__append_5)
 INTROSPECTION_COMPILER_ARGS = --includedir=$(srcdir)
 @HAVE_INTROSPECTION_TRUE@GnomeDesktop_3_0_gir_INCLUDES = GObject-2.0 Gtk-3.0 GDesktopEnums-3.0
 @HAVE_INTROSPECTION_TRUE@GnomeDesktop_3_0_gir_PACKAGES = gdk-pixbuf-2.0 glib-2.0 gobject-2.0 gio-2.0 gtk+-3.0 gsettings-desktop-schemas
@@ -720,7 +728,7 @@ libgnome-desktop-3.la: $(libgnome_deskto
 	$(AM_V_CCLD)$(libgnome_desktop_3_la_LINK) -rpath $(libdir) $(libgnome_desktop_3_la_OBJECTS) $(libgnome_desktop_3_la_LIBADD) $(LIBS)
 
 libgsystem.la: $(libgsystem_la_OBJECTS) $(libgsystem_la_DEPENDENCIES) $(EXTRA_libgsystem_la_DEPENDENCIES) 
-	$(AM_V_CCLD)$(libgsystem_la_LINK)  $(libgsystem_la_OBJECTS) $(libgsystem_la_LIBADD) $(LIBS)
+	$(AM_V_CCLD)$(libgsystem_la_LINK) $(am_libgsystem_la_rpath) $(libgsystem_la_OBJECTS) $(libgsystem_la_LIBADD) $(LIBS)
 install-libexecPROGRAMS: $(libexec_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	@list='$(libexec_PROGRAMS)'; test -n "$(libexecdir)" || list=; \
@@ -851,14 +859,14 @@ distclean-compile:
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/$*.Tpo $(DEPDIR)/$*.Po
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(COMPILE) -c $<
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(COMPILE) -c -o $@ $<
 
 .c.obj:
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(COMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ `$(CYGPATH_W) '$<'`
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/$*.Tpo $(DEPDIR)/$*.Po
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(COMPILE) -c `$(CYGPATH_W) '$<'`
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(COMPILE) -c -o $@ `$(CYGPATH_W) '$<'`
 
 .c.lo:
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LTCOMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ $<
